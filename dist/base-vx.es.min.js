import Vue from"vue";const{$set:$set,$delete:$delete}=new Vue;let proxies={mutator:{copyWithin:"copyWithin",fill:"fill",unshift:"unshift",shift:"shift",push:"push",pop:"pop",reverse:"reverse",sort:"sort",splice:"splice"},accessor:{includes:"includes",concat:"concat",join:"join",slice:"slice",indexOf:"indexOf",lastIndexOf:"lastIndexOf",flat:"flat",toString:"toString",toLocaleString:"toLocaleString",forEach:"forEach",find:"find",findIndex:"findIndex",map:"map",filter:"filter",some:"some",every:"every",reduce:"reduce",reduceRight:"reduceRight",flatMap:"flatMap",keys:"keys",values:"values",entries:"entries",startsWith:"startsWith",endsWith:"endsWith",padEnd:"padEnd",padStart:"padStart",repeat:"repeat",normalize:"normalize",charAt:"charAt",charCodeAt:"charCodeAt",codePointAt:"codePointAt",localeCompare:"localeCompare",match:"match",replace:"replace",search:"search",split:"split",substr:"substr",substring:"substring",toLowerCase:"toLowerCase",toUpperCase:"toUpperCase",toLocaleLowerCase:"toLocaleLowerCase",toLocaleUpperCase:"toLocaleUpperCase",trim:"trim",trimLeft:"trimLeft",trimRight:"trimRight",toFixed:"toFixed",toPrecision:"toPrecision",toExponential:"toExponential"},custom:{set:set,del:del,increase:increase,decrease:decrease,toggle:toggle,each:each,q:q}};function set(t,e,...i){1===i.length?$set(t,e,i[0]):2===i.length&&$set(t[e],i[0],i[1])}function del(t,e,i){null==i?$delete(t,e):$delete(t[e],i)}function increase(t,e,i){t[e]=t[e]-(i&&"number"==typeof i?i:1)}function decrease(t,e,i){t[e]=t[e]+(i&&"number"==typeof i?i:1)}function toggle(t,e,...i){const s=t[e];Array.isArray(s)?i.forEach(t=>{const e=s.indexOf(t);~e?s.splice(e,1):s.push(t)}):"boolean"==typeof s&&(t[e]=!s)}function each(t,e,i,s){let o=t[e];isObj(o)?o=Object.entries(o):Array.isArray(o)&&(o=o.entries());for(let[n,r]of o)i.call(s,r,n,t[e])}function q(t,e,i){i(t[e],e,t)}function isObj(t){return t&&"[object Object]"===Object.prototype.toString.call(t)}function getTag(t){if("function"!=typeof t)for(let e in proxies){if(proxies[e][t])return e}else for(let e in proxies.custom){if(proxies.custom[e]===t)return"custom"}}function tailspin(t,e,i){let s=t,o=e.match(/[^\.\[\]]+/g);if(o){let t=(o=o.map(t=>Object.is(Number(t),NaN)?t:Number(t))).length;for(let[n,r]of o.entries()){if(null==s[r])throw new Error(`${e} -> path does not exist`);if(t<=n+1)return i(s,r);s=s[r]}}}let stores={};class BaseVX{constructor(...t){this._resetState(...t)._init()}static use(t){this._vuex=t}static add(t,e){return proxies.custom[t]=e,this}static only(t={},e){return"string"==typeof e&&(e=e.split(/ +/)),e.reduce((e,i)=>null==t[i]?e:(e[i]=t[i],e),{})}static singleton(...t){return this.instance&&this.instance._resetState(...t)||(this.instance=new BaseVX(...t))}static Store(t={}){return t.mutations&&(t.mutations={}),Object.assign(t.mutations,{[BaseVX.defaults.interiorKey]:mutation}),stores=new BaseVX._vuex.Store(t)}chain(t=!0){return this.options.chain=t,this}commit(){return stores.commit(BaseVX.defaults.interiorKey,[this.options._chainCallData,this.options]),this.options._chainCallData=[],this}_commit(t,e){return this.options._chainCallData.push({method:t,values:e}),this.options.chain||this.commit(),this}_resetState(...t){const[e,i={}]=t;return this.options={path:e,chain:i.chain||BaseVX.defaults.chain||!1,_chainCallData:[]},this}_init(){for(let t in proxies){const e=proxies[t];Object.keys(e).forEach(t=>BaseVX.prototype[t]=function(...i){return this._commit(e[t],i),this})}return this}}BaseVX.defaults={interiorKey:"__BaseVX__Mutation__",chain:!1};let vx=function(...t){return BaseVX.singleton(...t)};function mutation(t,e){const[i,s]=e,{path:o}=s;i.forEach(({method:e,values:i})=>{tailspin(t,o,function(t,s){if(["keys","values","entries"].includes(e))return void(isObj(t[s])&&(t[s]=Object[e](t[s])));switch(getTag(e)){case"mutator":t[s][e](...i);break;case"accessor":t[s]=t[s][e](...i);break;case"custom":e(t,s,...i)}})})}const version="0.0.1";export default BaseVX;export{vx,version};
